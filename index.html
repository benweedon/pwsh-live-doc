<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8" />
        <title>Script Test Results</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/default.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>
        <script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/languages/powershell.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </head>
    <body> <p>When <code>$ErrorActionPreference</code> is <code>Stop</code>,
<code>$PSCmdlet.WriteError</code> exits the current advanced function and
throws. However, the exception it throws is not catchable from within the
advanced function.</p> <pre><code class="powershell">function TestWriteErrorFunction {
    [CmdletBinding()]
    param()

    $local:ErrorActionPreference = "Stop"
    try {
        $PSCmdlet.WriteError((NewErrorRecord "error in try"))
    } catch {
        Write-Output "caught inside the cmdlet: $_"
    }

    Write-Output "after the try-catch"
}

try {
    TestWriteErrorFunction
} catch {
    Write-Output "caught outside the cmdlet: $_"
}
</code></pre>
<pre><p>caught outside the cmdlet: error in try</p></pre> <p>Write-Error, on the other hand, is catchable inside the function, for both
advanced and basic functions.</p> <pre><code class="powershell">function TestWriteErrorCmdletAdvanced {
    [CmdletBinding()]
    param()

    $local:ErrorActionPreference = "Stop"
    try {
        Write-Error "error in try"
    } catch {
        Write-Output "caught inside the cmdlet: $_"
    }

    Write-Output "after the try-catch"
}

function TestWriteErrorCmdletBasic {
    [CmdletBinding()]
    param()

    $local:ErrorActionPreference = "Stop"
    try {
        Write-Error "error in try"
    } catch {
        Write-Output "caught inside the cmdlet: $_"
    }

    Write-Output "after the try-catch"
}

Write-Output "testing advanced function"
try {
    TestWriteErrorCmdletAdvanced
} catch {
    Write-Output "caught outside the cmdlet: $_"
}

Write-Output "testing basic function"
try {
    TestWriteErrorCmdletBasic
} catch {
    Write-Output "caught outside the cmdlet: $_"
}
</code></pre>
<pre><p>testing advanced function
caught inside the cmdlet: error in try
after the try-catch
testing basic function
caught inside the cmdlet: error in try
after the try-catch</p></pre>     </body>
</html>
